TODO document what is going on here
